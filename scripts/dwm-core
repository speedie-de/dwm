#!/bin/sh
# dwm-core
# This script handles the systray and other things necessary for usage.

#trayer --edge top --align right --SetDockType true --SetPartialStrut true --expand true --width 8 --transparent true --alpha 0 --tint 0x292d3e --height 8 &

BINDIR=$(cat /usr/share/dwm-bindir)
TINT="222222" # Default tint
OPT=$1

PYWAL_TINT() {
  # Pywal tint
  if [ -e "$HOME/.cache/wal/colors" ]; then
		#TINT=$(sed -n 13,13p $HOME/.cache/wal/colors | sed "s|#||g")
		TINT=$(sed -n 1,1p $HOME/.cache/wal/colors | sed "s|#||g")
  fi
}

PYWAL_TINT

USE() {
  # Toggle
  TOGGLE() {
    if [ -e "/tmp/systray-started" ]; then
		  OPT="-stop"
    else
		  OPT="-start"
    fi
		  
  }
  
  case "$OPT" in
  "-toggle") TOGGLE ;;
  esac
  
  case "$OPT" in
  "-start") trayer --edge top --align right --SetDockType true --SetPartialStrut true --expand true --width 8 --transparent true --alpha 0 --tint 0x${TINT} --height 10 &
		    touch /tmp/systray-started ; pkill status ; status & ;;
  "-stop") rm -f /tmp/systray-started ; pkill trayer ; pkill status ; status & ;;
  "") echo "-start | Start the systray and restart status\n-stop | Stop the systray and restart status\n-toggle | Toggle systray and restart status" ;;
  esac
}

# Start systray
if [ -e "${BINDIR}trayer" ]; then
		USE
else
		echo "Trayer not installed, exiting." && exit 1
fi
